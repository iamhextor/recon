import dns.resolver
import requests

# Open the file with URLs
with open("urls.txt", "r") as file:
    urls = [line.strip() for line in file]

# Open the output file
output_file = open("output.txt", "w")

# Check each URL
for url in urls:
    # Print the URL
    output_file.write(f"{url}\n")
    
    # Check SPF record
    try:
        spf = dns.resolver.query(url, "TXT")
        spf_record = ""
        for rdata in spf:
            spf_record += rdata.to_text()
        if "v=spf1" in spf_record:
            output_file.write("\033[92mSPF record found\033[0m\n")
        else:
            output_file.write("\033[91mSPF record not found\033[0m\n")
    except dns.resolver.NoAnswer:
        output_file.write("\033[91mSPF record not found\033[0m\n")
    
    # Check DMARC record
    try:
        dmarc = dns.resolver.query(f"_dmarc.{url}", "TXT")
        dmarc_record = ""
        for rdata in dmarc:
            dmarc_record += rdata.to_text()
        if "v=DMARC1" in dmarc_record:
            output_file.write("\033[92mDMARC record published\033[0m\n")
            if "p=reject" in dmarc_record or "p=quarantine" in dmarc_record:
                output_file.write("\033[92mDMARC policy enabled\033[0m\n")
            else:
                output_file.write("\033[93mDMARC policy not enabled\033[0m\n")
        else:
            output_file.write("\033[91mNo DMARC record published\033[0m\n")
            output_file.write("\033[93mDMARC policy not enabled\033[0m\n")
    except dns.resolver.NoAnswer:
        output_file.write("\033[91mNo DMARC record published\033[0m\n")
        output_file.write("\033[93mDMARC policy not enabled\033[0m\n")

    # Check DNS record
    try:
        ip_address = dns.resolver.query(url, "A")[0].to_text()
        output_file.write("\033[92mDNS record published\033[0m\n")
    except (dns.resolver.NoAnswer, dns.resolver.NXDOMAIN):
        output_file.write("\033[91mDNS record not published\033[0m\n")
    
    # Add a separator for the next URL
    output_file.write("="*50 + "\n")

# Close the output file
output_file.close()
