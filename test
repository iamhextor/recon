import dns.resolver
from termcolor import colored

# Define the filename containing the URLs
filename = "urls.txt"

# Open the file and read in the URLs
with open(filename) as f:
    urls = f.readlines()

# Iterate over the URLs and retrieve the SPF and DMARC records
for url in urls:
    # Strip newline character from the end of the URL
    url = url.rstrip()
    
    # Retrieve the SPF record
    try:
        spf_answer = dns.resolver.query(url, 'TXT')
        spf_found = False
        for rdata in spf_answer:
            if 'v=spf1' in str(rdata):
                spf_found = True
                print(colored(f"{url} SPF record published.", "green"))
                break
        if not spf_found:
            print(colored(f"{url} has no SPF record published.", "red"))
    except:
        print(colored(f"{url} has no SPF record published.", "red"))
    
    # Retrieve the DMARC record
    try:
        dmarc_answer = dns.resolver.query(f"_dmarc.{url}", 'TXT')
        dmarc_found = False
        for rdata in dmarc_answer:
            if 'v=DMARC1' in str(rdata):
                dmarc_found = True
                print(colored(f"{url} DMARC record published.", "green"))
                
                # Check if a DMARC policy is enabled
                dmarc_policy = [x.split(";") for x in rdata.strings][0]
                if any(x.strip().startswith("p=reject") for x in dmarc_policy):
                    print(colored(f"{url} DMARC policy enabled.", "green"))
                else:
                    print(colored(f"{url} DMARC policy not enabled.", "yellow"))
                break
        if not dmarc_found:
            print(colored(f"{url} has no DMARC record published.", "red"))
    except:
        print(colored(f"{url} has no DMARC record published.", "red"))
        
    # Check if DNS record is published
    try:
        dns_answer = dns.resolver.query(url, 'A')
        print(colored(f"{url} DNS record published.", "green"))
    except:
        print(colored(f"{url} has no DNS record published.", "red"))
