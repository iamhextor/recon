ips_to_search = []

# Read the IP addresses from ips.txt file
with open("ips.txt", "r") as f:
    ips_to_search = [line.strip() for line in f]

# Get the list of sites
response = requests.get(site_url, auth=(username, password), verify=False)
if response.status_code == 200:
    site_list = response.json()["resources"]
else:
    print("Failed to get site list")
    exit()

# Search for each IP address in the included targets of all the sites
for ip_to_search in ips_to_search:
    found_in_sites = []
    for site in site_list:
        site_id = site["id"]
        site_name = site["name"]
        url = f"{site_url}/{site_id}/included_targets"
        response = requests.get(url, auth=(username, password), verify=False)
        if response.status_code == 200 and response.json() and "data" in response.json():
            included_targets = response.json()["data"]
            for target in included_targets:
                if target["address"] == ip_to_search:
                    found_in_sites.append(site_name)
                    break
    if found_in_sites:
        print(f"IP {ip_to_search} is added in the following site(s): {', '.join(found_in_sites)}")
    else:
        print(f"IP {ip_to_search} is not added in any site")
