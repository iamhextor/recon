import requests
import urllib3
from getpass import getpass

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

username = input("Username (E-id): ")
password = getpass("Password: ")

# API call to retrieve all the sites
ips_file = "ips.txt"
with open(ips_file, "r") as f:
    ips = f.read().splitlines()

# API call to retrieve the asset ID of each IP
asset_ids = []
for ip in ips:
    assets_url = f"https://nexpose_url:port/api/3/assets?ip={ip}"
    assets_response = requests.get(assets_url, auth=(username, password), verify=False)
    if assets_response.status_code != 200:
        print(f"Error retrieving assets: {assets_response.status_code}")
        continue

    assets_json = assets_response.json()
    if assets_json["resources"]:
        asset_id = assets_json["resources"][0]["id"]
        asset_ids.append(asset_id)
    else:
        print(f"No asset found for IP: {ip}")

# Print the asset IDs for each IP
for ip, asset_id in zip(ips, asset_ids):
    print(f"IP: {ip} - Asset ID: {asset_id}")
