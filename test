import requests

# Set API endpoint and authentication credentials
url = "https://nespose_ip:port/api/3/assets/search"
username = input("Username (E-id): ")
password = input("Password: ")

# Read IPs from input file
with open("ips.txt") as f:
    ips_to_search = [ip.strip() for ip in f]

# Loop over IPs and send API request
for ip in ips_to_search:
    data = {
        "filters": [
            {"field": "ip-address", "operator": "is", "value": ip}
        ],
        "match": "any"
    }
    response = requests.post(url, auth=(username, password), json=data, verify=False)
    
    # Check if IP was found and print site name(s) if it was
    if response.status_code == 200 and response.json()["totalResources"] > 0:
        sites = [asset["site"]["name"] for asset in response.json()["resources"]]
        print(f"{ip} found in site(s): {', '.join(sites)}")
    else:
        print(f"{ip} not found")
